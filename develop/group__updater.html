<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="dark-mode">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.13.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AUI Framework: aui::updater</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_doxygen.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AUI Framework
   &#160;<span id="projectnumber">develop</span>
   </div>
   <div id="projectbrief">Cross-platform base for C++ UI apps</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__updater.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">aui::updater</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Deliver updates on non-centralized distribution methods. </p>
<p>This module is purposed for delivering updates to your end users on distribution methods that do not support that by themselves (i.e., occasional Windows installers, portables for Windows and Linux, macOS app bundles downloaded from your website).</p>
<p><code>aui.updater</code> module expects your program to be installed to user's directory (i.e., updating does not require admin priveleges). If that's not your case, you'll need to update your <a class="el" href="md_docs_2Packaging_01Your_01App.html#INNOSETUP">installer configuration</a> to install to user's directory (i.e., in <code>AppData</code>).</p>
<dl class="section note"><dt>Note</dt><dd>Check out our <a href="https://github.com/aui-framework/example_app">app template</a> for a GitHub-hosted app template with auto update implemented. <div class="image">
<img src="afljskfllkaf.gif" alt=""/>
</div>
</dd></dl>
<h1><a class="anchor" id="autotoc_md176"></a>
Supported platforms</h1>
<p><code>aui::updater</code> supports the following platforms:</p><ul>
<li><b>Windows</b> - <a class="el" href="md_docs_2Packaging_01Your_01App.html#PORTABLE_WINDOWS">portables</a> only, installers to user's directory only (<a class="el" href="md_docs_2Packaging_01Your_01App.html#INNOSETUP">Inno Setup</a>)</li>
<li><b>Linux</b> - portables only</li>
</ul>
<p>On a supported platform, <code>aui::updater</code> checks if the app executable is writable by the current user. If the executable is not writeable, or running on a non-supported platform, <code><a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a></code> stubs it's methods (i.e., they do nothing). You can check that the <code>aui::updater</code> functionality is engaged by calling <code><a class="el" href="classAUpdater.html#a9a0d6b9d2c23abc25cf03c6140de5bff" title="Checks that updater functionality is available.">AUpdater::isAvailable()</a></code>.</p>
<p>Updating process requires the initial application running instance to be stopped to replace its files with newer ones. Additionally, the updater process starts the newer version of the application after replacing the files (applying/deploying an update). To minimize downtime for end-users, the replacement should be seamless and quick and thus the deployment process just copies newer files (overwriting old ones), it does not involve network operations.</p>
<h1><a class="anchor" id="autotoc_md177"></a>
Getting started</h1>
<p><code><a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a></code> lives inside entrypoint of your application. It needs you to pass program arguments. It might decide to terminate process execution via std::exit. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MyUpdater : <span class="keyword">public</span> <a class="code hl_class" href="classAUpdater.html">AUpdater</a> {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <a class="code hl_class" href="classAFuture.html">AFuture&lt;void&gt;</a> <a class="code hl_function" href="classAUpdater.html#a988e31376a10073a79634a25424701ef">checkForUpdatesImpl</a>()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <a class="code hl_define" href="group__useful__macros.html#gada84521eeb4bb9ac422d21429806aff3">async</a> { <span class="comment">/* stub */</span> }; }</div>
<div class="line">    AFuture&lt;void&gt; <a class="code hl_function" href="classAUpdater.html#a3727ff4ff2c6c907c13ccf216a3c4d2f">downloadUpdateImpl</a>(<span class="keyword">const</span> APath&amp; unpackedUpdateDir)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <a class="code hl_define" href="group__useful__macros.html#gada84521eeb4bb9ac422d21429806aff3">async</a> { <span class="comment">/* stub */</span> }; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a> {</div>
<div class="line">    <span class="keyword">auto</span> updater = _new&lt;MyUpdater&gt;();</div>
<div class="line">    updater-&gt;handleStartup(args);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// your program routines (i.e., open a window)</span></div>
<div class="line">    _new&lt;MainWindow&gt;(updater)-&gt;show();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassAFuture_html"><div class="ttname"><a href="classAFuture.html">AFuture</a></div><div class="ttdoc">Represents a value that will be available at some point in the future.</div><div class="ttdef"><b>Definition</b> AFuture.h:620</div></div>
<div class="ttc" id="aclassAUpdater_html"><div class="ttname"><a href="classAUpdater.html">AUpdater</a></div><div class="ttdoc">Updater class.</div><div class="ttdef"><b>Definition</b> AUpdater.h:29</div></div>
<div class="ttc" id="aclassAUpdater_html_a3727ff4ff2c6c907c13ccf216a3c4d2f"><div class="ttname"><a href="classAUpdater.html#a3727ff4ff2c6c907c13ccf216a3c4d2f">AUpdater::downloadUpdateImpl</a></div><div class="ttdeci">virtual AFuture&lt; void &gt; downloadUpdateImpl(const APath &amp;unpackedUpdateDir)=0</div><div class="ttdoc">Performs update delivery to the specified directory.</div></div>
<div class="ttc" id="aclassAUpdater_html_a988e31376a10073a79634a25424701ef"><div class="ttname"><a href="classAUpdater.html#a988e31376a10073a79634a25424701ef">AUpdater::checkForUpdatesImpl</a></div><div class="ttdeci">virtual AFuture&lt; void &gt; checkForUpdatesImpl()=0</div><div class="ttdoc">Check for updates user&#39;s implementation.</div></div>
<div class="ttc" id="agroup__useful__macros_html_ga9fb2be9313369673815a6892aa7f3a1f"><div class="ttname"><a href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a></div><div class="ttdeci">#define AUI_ENTRY</div><div class="ttdoc">Application entry point.</div><div class="ttdef"><b>Definition</b> Entry.h:69</div></div>
<div class="ttc" id="agroup__useful__macros_html_gada84521eeb4bb9ac422d21429806aff3"><div class="ttname"><a href="group__useful__macros.html#gada84521eeb4bb9ac422d21429806aff3">async</a></div><div class="ttdeci">#define async</div><div class="ttdoc">Executes following {} block asynchronously in the global thread pool. Unlike asyncX,...</div><div class="ttdef"><b>Definition</b> kAUI.h:329</div></div>
</div><!-- fragment --><p>You can pass updater instance to your window (as shown in the example) and display update information from <code><a class="el" href="classAUpdater.html#a1e6e8f3dcd758c1aa6d327102ab46a71" title="State of the updater.">AUpdater::status</a></code> and perform the update when requested.</p>
<h1><a class="anchor" id="autotoc_md178"></a>
Observing update progress</h1>
<p>Status of the <a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> to observe from outside, i.e., by UI.</p>
<p><code>status</code> is updated in UI thread only.</p>
<p><code>status</code> is designed in such a way the user can use their own custom status types or any of predefined ones:</p><ul>
<li><a class="el" href="structAUpdater_1_1StatusIdle.html">AUpdater::StatusIdle</a></li>
<li><a class="el" href="structAUpdater_1_1StatusCheckingForUpdates.html">AUpdater::StatusCheckingForUpdates</a></li>
<li><a class="el" href="structAUpdater_1_1StatusDownloading.html">AUpdater::StatusDownloading</a></li>
<li><a class="el" href="structAUpdater_1_1StatusWaitingForApplyAndRestart.html">AUpdater::StatusWaitingForApplyAndRestart</a></li>
<li><a class="el" href="structAUpdater_1_1StatusNotAvailable.html">AUpdater::StatusNotAvailable</a></li>
</ul>
<p>These statuses might be set by <a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> itself.</p>
<p>Typical observer of status is a UI projection displaying its value. You can even display controls in it: </p><div class="fragment"><div class="line">CustomLayout {} &amp; mUpdater-&gt;status.readProjected([&amp;updater = mUpdater](<span class="keyword">const</span> std::any&amp; status) -&gt; <a class="code hl_class" href="class__.html">_&lt;AView&gt;</a> {</div>
<div class="line">    <span class="keywordflow">if</span> (std::any_cast&lt;AUpdater::StatusIdle&gt;(&amp;status)) {</div>
<div class="line">        <span class="keywordflow">return</span> _new&lt;AButton&gt;(<span class="stringliteral">&quot;Check for updates&quot;</span>).connect(&amp;<a class="code hl_variable" href="classAView.html#af2361cde3ebf9e0b410c28dab746029d">AView::clicked</a>, <a class="code hl_define" href="group__signal__slot.html#gaaaa072876366972108aef016e7882a99">slot</a>(updater)::checkForUpdates);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (std::any_cast&lt;AUpdater::StatusCheckingForUpdates&gt;(&amp;status)) {</div>
<div class="line">        <span class="keywordflow">return</span> Label { <span class="stringliteral">&quot;Checking for updates...&quot;</span> };</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> downloading = std::any_cast&lt;AUpdater::StatusDownloading&gt;(&amp;status)) {</div>
<div class="line">        <span class="keywordflow">return</span> Vertical {</div>
<div class="line">            Label { <span class="stringliteral">&quot;Downloading...&quot;</span> },</div>
<div class="line">            _new&lt;AProgressBar&gt;() &amp; downloading-&gt;progress,</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (std::any_cast&lt;AUpdater::StatusWaitingForApplyAndRestart&gt;(&amp;status)) {</div>
<div class="line">        <span class="keywordflow">return</span> _new&lt;AButton&gt;(<span class="stringliteral">&quot;Apply update and restart&quot;</span>)</div>
<div class="line">            .connect(&amp;<a class="code hl_variable" href="classAView.html#af2361cde3ebf9e0b410c28dab746029d">AView::clicked</a>, <a class="code hl_define" href="group__signal__slot.html#gaaaa072876366972108aef016e7882a99">slot</a>(updater)::applyUpdateAndRestart);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">}),</div>
<div class="ttc" id="aclassAView_html_af2361cde3ebf9e0b410c28dab746029d"><div class="ttname"><a href="classAView.html#af2361cde3ebf9e0b410c28dab746029d">AView::clicked</a></div><div class="ttdeci">emits clicked</div><div class="ttdoc">Left mouse button clicked.</div><div class="ttdef"><b>Definition</b> AView.h:900</div></div>
<div class="ttc" id="aclass___html"><div class="ttname"><a href="class__.html">_</a></div><div class="ttdoc">An std::weak_ptr with AUI extensions.</div><div class="ttdef"><b>Definition</b> SharedPtrTypes.h:178</div></div>
<div class="ttc" id="agroup__signal__slot_html_gaaaa072876366972108aef016e7882a99"><div class="ttname"><a href="group__signal__slot.html#gaaaa072876366972108aef016e7882a99">slot</a></div><div class="ttdeci">#define slot(v)</div><div class="ttdoc">Passes some variable and type of the variable separated by comma. It&#39;s convenient to use with the con...</div><div class="ttdef"><b>Definition</b> kAUI.h:88</div></div>
</div><!-- fragment -->   <h1><a class="anchor" id="autotoc_md179"></a>
Update process</h1>
<h2><a class="anchor" id="autotoc_md180"></a>
Checking for updates</h2>
<p><a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> expects <a class="el" href="classAUpdater.html#ad0df1b1eaa58c79f7be6b3b2d4b341f3">AUpdater::checkForUpdates</a> to be called to check for updates. It can be called once per some period of time. It calls user-defined <a class="el" href="classAUpdater.html#a988e31376a10073a79634a25424701ef">AUpdater::checkForUpdatesImpl</a> to perform an update checking.</p>
<p>The update steps are reported by changing <code><a class="el" href="classAUpdater.html#a1e6e8f3dcd758c1aa6d327102ab46a71" title="State of the updater.">AUpdater::status</a></code> property.</p>
<div class="mscgraph">
<img src="msc_inline_mscgraph_1.svg" alt="msc_inline_mscgraph_1" border="0" usemap="#msc_inline_mscgraph_1.map"/>
<map name="msc_inline_mscgraph_1.map" id="msc_inline_mscgraph_1.map"><area href="classAUpdater.html" shape="rect" coords="425,6,475,17" alt=""/>
<area href="classAUpdater.html#a7a5c6b8a79a6bab249f197210d66ee11" shape="rect" coords="254,22,347,33" alt=""/>
<area href="structAUpdater_1_1StatusIdle.html" shape="rect" coords="222,50,378,61" alt=""/>
<area href="classAUpdater.html#ad0df1b1eaa58c79f7be6b3b2d4b341f3" shape="rect" coords="249,140,351,151" alt=""/>
<area href="structAUpdater_1_1StatusCheckingForUpdates.html" shape="rect" coords="175,168,425,179" alt=""/>
<area href="classAUpdater.html#a988e31376a10073a79634a25424701ef" shape="rect" coords="388,230,513,241" alt=""/>
<area href="structAUpdater_1_1StatusIdle.html" shape="rect" coords="222,252,378,263" alt=""/>
<area href="classAUpdater.html#ad0df1b1eaa58c79f7be6b3b2d4b341f3" shape="rect" coords="249,331,351,342" alt=""/>
<area href="structAUpdater_1_1StatusCheckingForUpdates.html" shape="rect" coords="175,359,425,370" alt=""/>
<area href="classAUpdater.html#a988e31376a10073a79634a25424701ef" shape="rect" coords="388,421,513,432" alt=""/>
<area href="structAUpdater_1_1StatusIdle.html" shape="rect" coords="222,471,378,482" alt=""/>
</map>
</div>
<p>You might want to store update check results (i.e., download url) in your implementation of <a class="el" href="classAUpdater.html#a988e31376a10073a79634a25424701ef">AUpdater::checkForUpdatesImpl</a> so your <a class="el" href="classAUpdater.html#a3727ff4ff2c6c907c13ccf216a3c4d2f">AUpdater::downloadUpdateImpl</a> might reuse this information.</p>
<h2><a class="anchor" id="autotoc_md181"></a>
Downloading the update</h2>
<p>When an update is found, your app should call <a class="el" href="classAUpdater.html#adeb17ffdf5f26b2df85b0b95e56e05e5">AUpdater::downloadUpdate</a> to download and unpack the update. It is up to you to decide when to download an update. If you wish, you can call <a class="el" href="classAUpdater.html#adeb17ffdf5f26b2df85b0b95e56e05e5">AUpdater::downloadUpdate</a> in <a class="el" href="classAUpdater.html#a988e31376a10073a79634a25424701ef">AUpdater::checkForUpdatesImpl</a> to proceed to download process right after update was found (see <a class="el" href="#UPDATER_WORKFLOWS">Updater workflows</a> for more information about update workflow decisions). It calls user-defined <a class="el" href="classAUpdater.html#a3727ff4ff2c6c907c13ccf216a3c4d2f">AUpdater::downloadUpdateImpl</a> which might choose to call default <code><a class="el" href="classAUpdater.html#ae1db715d36c366c823542785e9b4a8a1" title="Typical download and unpack implementation.">AUpdater::downloadAndUnpack</a>(&lt;YOUR DOWNLOAD URL&gt;, unpackedUpdateDir)</code>.</p>
<div class="mscgraph">
<img src="msc_inline_mscgraph_2.svg" alt="msc_inline_mscgraph_2" border="0" usemap="#msc_inline_mscgraph_2.map"/>
<map name="msc_inline_mscgraph_2.map" id="msc_inline_mscgraph_2.map"><area href="classAUpdater.html" shape="rect" coords="425,6,475,17" alt=""/>
<area href="classAUpdater.html#adeb17ffdf5f26b2df85b0b95e56e05e5" shape="rect" coords="251,39,349,50" alt=""/>
<area href="structAUpdater_1_1StatusDownloading.html" shape="rect" coords="197,67,403,78" alt=""/>
<area href="classAUpdater.html#a3727ff4ff2c6c907c13ccf216a3c4d2f" shape="rect" coords="390,101,511,112" alt=""/>
<area href="structAUpdater_1_1StatusWaitingForApplyAndRestart.html" shape="rect" coords="158,123,443,134" alt=""/>
</map>
</div>
<h2><a class="anchor" id="autotoc_md182"></a>
Applying (deploying) the update</h2>
<p>At this moment, <a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> waits <a class="el" href="classAUpdater.html#ac0945a7562305a181f3481cb8f170717">AUpdater::applyUpdateAndRestart</a> to be called. When <a class="el" href="classAUpdater.html#ac0945a7562305a181f3481cb8f170717">AUpdater::applyUpdateAndRestart</a> is called (i.e., when user accepted update installation), <a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> executes the newer copy of your app downloaded before with a special command line argument which is handled by <a class="el" href="classAUpdater.html#a7a5c6b8a79a6bab249f197210d66ee11">AUpdater::handleStartup</a> in that executable. The initial app process is finished, closing your app window as well. From now, your app is in "downtime" state, so we need to apply the update and reopen app back again as quickly as possible. This action is required to perform update installation. The copy then replaces old application (where it actually installed) with itself (that is, the downloaded, newer copy). After operation is complete, it passes the control back to the updated application executable. At last, the newly updated application performs a cleanup after update.</p>
<div class="mscgraph">
<img src="msc_inline_mscgraph_3.svg" alt="msc_inline_mscgraph_3" border="0" usemap="#msc_inline_mscgraph_3.map"/>
<map name="msc_inline_mscgraph_3.map" id="msc_inline_mscgraph_3.map"><area href="classAUpdater.html" shape="rect" coords="200,6,250,17" alt=""/>
<area href="classAUpdater.html" shape="rect" coords="466,6,584,17" alt=""/>
<area href="classAUpdater.html#ac0945a7562305a181f3481cb8f170717" shape="rect" coords="83,22,218,33" alt=""/>
<area href="classAUpdater.html#a7a5c6b8a79a6bab249f197210d66ee11" shape="rect" coords="413,162,488,173" alt=""/>
<area href="classAUpdater.html#ad71d7ba30e218c44a7cd5e92d47cd932" shape="rect" coords="466,190,585,201" alt=""/>
<area href="classAUpdater.html#ad71d7ba30e218c44a7cd5e92d47cd932" shape="rect" coords="508,201,543,212" alt=""/>
<area href="classAUpdater.html#a7a5c6b8a79a6bab249f197210d66ee11" shape="rect" coords="113,330,188,341" alt=""/>
</map>
</div>
<p>After these operations complete, your app is running in its normal lifecycle.</p>
<p><a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> is an abstract class; it needs some functions to be implemented by you.</p>
<p>In this example, let's implement auto update from GitHub release pages. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> LOG_TAG = <span class="stringliteral">&quot;MyUpdater&quot;</span>;</div>
<div class="line"><span class="keyword">class </span>MyUpdater: <span class="keyword">public</span> <a class="code hl_class" href="classAUpdater.html">AUpdater</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    ~MyUpdater() <span class="keyword">override</span> = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <a class="code hl_class" href="classAFuture.html">AFuture&lt;void&gt;</a> <a class="code hl_function" href="classAUpdater.html#a988e31376a10073a79634a25424701ef">checkForUpdatesImpl</a>()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_define" href="group__useful__macros.html#gada84521eeb4bb9ac422d21429806aff3">async</a> {</div>
<div class="line">            <span class="keywordflow">try</span> {</div>
<div class="line">                <span class="keyword">auto</span> githubLatestRelease = aui::updater::github::latestRelease(<span class="stringliteral">&quot;aui-framework&quot;</span>, <span class="stringliteral">&quot;example_app&quot;</span>);</div>
<div class="line">                ALogger::info(LOG_TAG) &lt;&lt; <span class="stringliteral">&quot;Found latest release: &quot;</span> &lt;&lt; githubLatestRelease.tag_name;</div>
<div class="line">                <span class="keyword">auto</span> ourVersion = <a class="code hl_function" href="structaui_1_1updater_1_1Semver.html#a3e4cd3ca998ea8650bbf613bdd810b2a">aui::updater::Semver::fromString</a>(<a class="code hl_define" href="group__useful__macros.html#gaa250d8839c4736760fdd5c4990fded23">AUI_PP_STRINGIZE</a>(AUI_CMAKE_PROJECT_VERSION));</div>
<div class="line">                <span class="keyword">auto</span> theirVersion = <a class="code hl_function" href="structaui_1_1updater_1_1Semver.html#a3e4cd3ca998ea8650bbf613bdd810b2a">aui::updater::Semver::fromString</a>(githubLatestRelease.tag_name);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (theirVersion &lt;= ourVersion) {</div>
<div class="line">                    getThread()-&gt;enqueue([] {</div>
<div class="line">                      AMessageBox::show(</div>
<div class="line">                          <span class="keyword">nullptr</span>, <span class="stringliteral">&quot;No updates found&quot;</span>, <span class="stringliteral">&quot;You are running the latest version.&quot;</span>, AMessageBox::Icon::INFO);</div>
<div class="line">                    });</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                aui::updater::AppropriatePortablePackagePredicate predicate {};</div>
<div class="line">                <span class="keyword">auto</span> it = ranges::find_if(</div>
<div class="line">                    githubLatestRelease.assets, predicate, &amp;aui::updater::github::LatestReleaseResponse::Asset::name);</div>
<div class="line">                <span class="keywordflow">if</span> (it == ranges::end(githubLatestRelease.assets)) {</div>
<div class="line">                    ALogger::warn(LOG_TAG)</div>
<div class="line">                        &lt;&lt; <span class="stringliteral">&quot;Newer version was found but a package appropriate for your platform is not available. &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;Expected: &quot;</span></div>
<div class="line">                        &lt;&lt; predicate.getQualifierDebug() &lt;&lt; <span class="stringliteral">&quot;, got: &quot;</span></div>
<div class="line">                        &lt;&lt; (githubLatestRelease.assets |</div>
<div class="line">                            ranges::view::transform(&amp;aui::updater::github::LatestReleaseResponse::Asset::name));</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                ALogger::info(LOG_TAG) &lt;&lt; <span class="stringliteral">&quot;To download: &quot;</span> &lt;&lt; (mDownloadUrl = it-&gt;browser_download_url);</div>
<div class="line"> </div>
<div class="line">                getThread()-&gt;enqueue([<span class="keyword">this</span>, self = shared_from_this(), version = githubLatestRelease.tag_name] {</div>
<div class="line">                    if (AMessageBox::show(</div>
<div class="line">                            nullptr, <span class="stringliteral">&quot;New version found!&quot;</span>, <span class="stringliteral">&quot;Found version: {}\n\nWould you like to update?&quot;</span>_format(version),</div>
<div class="line">                            AMessageBox::Icon::INFO, AMessageBox::Button::YES_NO) != AMessageBox::ResultButton::YES) {</div>
<div class="line">                        return;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    downloadUpdate();</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">            } <span class="keywordflow">catch</span> (<span class="keyword">const</span> AException&amp; e) {</div>
<div class="line">                ALogger::err(LOG_TAG) &lt;&lt; <span class="stringliteral">&quot;Can&#39;t check for updates: &quot;</span> &lt;&lt; e;</div>
<div class="line">                getThread()-&gt;enqueue([] {</div>
<div class="line">                    AMessageBox::show(</div>
<div class="line">                        <span class="keyword">nullptr</span>, <span class="stringliteral">&quot;Oops!&quot;</span>, <span class="stringliteral">&quot;There is an error occurred while checking for updates. Please try again later.&quot;</span>,</div>
<div class="line">                        AMessageBox::Icon::CRITICAL);</div>
<div class="line">                });</div>
<div class="line">            }</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classAFuture.html">AFuture&lt;void&gt;</a> downloadUpdateImpl(<span class="keyword">const</span> <a class="code hl_class" href="classAPath.html">APath</a>&amp; unpackedUpdateDir)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_define" href="group__useful__macros.html#gada84521eeb4bb9ac422d21429806aff3">async</a> {</div>
<div class="line">          <span class="keywordflow">try</span> {</div>
<div class="line">              <a class="code hl_define" href="group__useful__macros.html#gae43a68976a4d8539e92ff86fc034218c">AUI_ASSERTX</a>(!mDownloadUrl.empty(), <span class="stringliteral">&quot;make a successful call to checkForUpdates first&quot;</span>);</div>
<div class="line">              downloadAndUnpack(mDownloadUrl, unpackedUpdateDir);</div>
<div class="line">              reportReadyToApplyAndRestart(makeDefaultInstallationCmdline());</div>
<div class="line">          } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="classAException.html">AException</a>&amp; e) {</div>
<div class="line">              ALogger::err(LOG_TAG) &lt;&lt; <span class="stringliteral">&quot;Can&#39;t check for updates: &quot;</span> &lt;&lt; e;</div>
<div class="line">              getThread()-&gt;enqueue([] {</div>
<div class="line">                AMessageBox::show(</div>
<div class="line">                    <span class="keyword">nullptr</span>, <span class="stringliteral">&quot;Oops!&quot;</span>, <span class="stringliteral">&quot;There is an error occurred while downloading update. Please try again later.&quot;</span>,</div>
<div class="line">                    AMessageBox::Icon::CRITICAL);</div>
<div class="line">              });</div>
<div class="line">          }</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code hl_class" href="classAString.html">AString</a> mDownloadUrl;</div>
<div class="line">};</div>
<div class="ttc" id="aclassAException_html"><div class="ttname"><a href="classAException.html">AException</a></div><div class="ttdoc">Abstract AUI exception.</div><div class="ttdef"><b>Definition</b> AException.h:28</div></div>
<div class="ttc" id="aclassAPath_html"><div class="ttname"><a href="classAPath.html">APath</a></div><div class="ttdoc">An add-on to AString with functions for working with the path.</div><div class="ttdef"><b>Definition</b> APath.h:128</div></div>
<div class="ttc" id="aclassAString_html"><div class="ttname"><a href="classAString.html">AString</a></div><div class="ttdoc">Represents a Unicode character string.</div><div class="ttdef"><b>Definition</b> AString.h:37</div></div>
<div class="ttc" id="agroup__useful__macros_html_gaa250d8839c4736760fdd5c4990fded23"><div class="ttname"><a href="group__useful__macros.html#gaa250d8839c4736760fdd5c4990fded23">AUI_PP_STRINGIZE</a></div><div class="ttdeci">#define AUI_PP_STRINGIZE(...)</div><div class="ttdoc">Expands and stringifies the only argument.</div><div class="ttdef"><b>Definition</b> APreprocessor.h:28</div></div>
<div class="ttc" id="agroup__useful__macros_html_gae43a68976a4d8539e92ff86fc034218c"><div class="ttname"><a href="group__useful__macros.html#gae43a68976a4d8539e92ff86fc034218c">AUI_ASSERTX</a></div><div class="ttdeci">#define AUI_ASSERTX(condition, what)</div><div class="ttdoc">Asserts that the passed condition evaluates to true. Adds extra message string.</div><div class="ttdef"><b>Definition</b> Assert.h:74</div></div>
<div class="ttc" id="astructaui_1_1updater_1_1Semver_html_a3e4cd3ca998ea8650bbf613bdd810b2a"><div class="ttname"><a href="structaui_1_1updater_1_1Semver.html#a3e4cd3ca998ea8650bbf613bdd810b2a">aui::updater::Semver::fromString</a></div><div class="ttdeci">static Semver fromString(const AString &amp;version)</div><div class="ttdoc">Parse semver from string.</div><div class="ttdef"><b>Definition</b> Semver.cpp:4</div></div>
</div><!-- fragment --><h1><a class="anchor" id="UPDATER_WORKFLOWS"></a>
Updater workflows</h1>
<p>When using <a class="el" href="classAUpdater.html" title="Updater class.">AUpdater</a> for your application, you need to consider several factors including usability, user experience, system resources, and particular needs of your project.</p>
<p>Either way, you might want to implement a way to disable auto update feature in your application.</p>
<h2><a class="anchor" id="autotoc_md183"></a>
Prompt user on every step</h2>
<p>This approach is implemented in AUI's <a href="https://github.com/aui-framework/example_app">Example App Template</a>.</p>
<p>The updater checks for updater periodically or upon user request and informs the user that an update is available. The user then decides whether to proceed with update or not. If they agree the application will download and install the update.</p>
<p>This way can be considered as better approach because the user may feel they control the situation and the application never does things that user never asked to (trust concerns). On the other hand, such requirement of additional user interaction to can distract them from doing their work, so these interactions should not be annoying.</p>
<p>You should not use AMessageBox (unless user explicitly asked to check for update) as it literally interrupts the user's workflow, opting them to make a decision before they can continue their work. A great example of a bad auto update implementation is qBittorrent client on Windows: hence this application typically launches on OS startup, it checks for updates in background and pops the message box if update was found, <b>even if user is focused on another application or away from keyboard</b>.</p>
<h2><a class="anchor" id="autotoc_md184"></a>
Silent download</h2>
<p>This approach is implemented in AUI's <a href="https://github.com/aui-framework/telegram_client">Telegram client</a>, as well as in official Qt-based Telegram Desktop client.</p>
<p>The updater silently downloads the update in the background while the user continues working within the application or even other tasks. The update then is applied automatically upon restart. Optionally, the application might show a button/message/notification bubble to restart and apply update.</p>
<p>Despite user trust concerns, this approach allows seamless experience - users don't need to be interrupted during their work. They even might not care about updates. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaui_1_1updater_1_1AppropriatePortablePackagePredicate.html">aui::updater::AppropriatePortablePackagePredicate</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines whether the passed package name is a portable package that matches current arch and platform.  <a href="structaui_1_1updater_1_1AppropriatePortablePackagePredicate.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAUpdater.html">AUpdater</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updater class.  <a href="classAUpdater.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaui_1_1updater_1_1Semver.html">aui::updater::Semver</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semantic version.  <a href="structaui_1_1updater_1_1Semver.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<p class="footer-inner">
    &copy; 2025 AUI Framework Contributors. Documentation contributions included herein are the copyrights of their
    respective owners. The documentation provided herein is licensed under the terms of the GNU Free Documentation
    License version 1.3 as published by the Free Software Foundation. All trademarks are property of their respective owners.
</p>

</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
</body>
</html>
