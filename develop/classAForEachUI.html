<!-- HTML header for doxygen 1.9.1--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html class="dark-mode" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>
<meta content="Doxygen 1.13.1" name="generator"/>
<meta content="width=device-width, initial-scale=0.8" name="viewport"/>
<title>AUI Framework: AForEachUI&lt; T &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"/>
<script src="jquery.js" type="text/javascript"></script>
<script src="dynsections.js" type="text/javascript"></script>
<script src="toc.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js" type="text/javascript"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script src="navtreedata.js" type="text/javascript"></script>
<script src="navtree.js" type="text/javascript"></script>
<script src="resize.js" type="text/javascript"></script>
<script src="cookie.js" type="text/javascript"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script src="search/searchdata.js" type="text/javascript"></script>
<script src="search/search.js" type="text/javascript"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellpadding="0" cellspacing="0">
<tbody>
<tr style="height: 56px;">
<td id="projectlogo"><img alt="Logo" src="logo_doxygen.svg"/></td>
<td id="projectalign" style="padding-left: 0.5em;">
<div id="projectname">AUI Framework
                         <span id="projectnumber">develop</span>
</div>
<div id="projectbrief">Cross-platform base for C++ UI apps</div>
</td>
</tr>
</tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script src="menudata.js" type="text/javascript"></script>
<script src="menu.js" type="text/javascript"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classAForEachUI.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
</div>
<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>
<div class="header">
<div class="headertitle"><div class="title">AForEachUI&lt; T &gt; Class Template Reference<div class="ingroups"><a class="el" href="group__views.html">aui::views</a> » <a class="el" href="group__useful__views.html">Views</a></div></div></div>
</div><!--header-->
<div class="contents aui-toc-contents"><div class="contents-rails-left"><b aui-src="aui.views/src/AUI/View/AForEachUI.h#L239"></b>
<p>Customizable lists display.  
 <a href="#details">More...</a></p>
<p><code>#include &lt;<a class="el" href="AForEachUI_8h_source.html">AUI/View/AForEachUI.h</a>&gt;</code></p>
<a id="details" name="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename T&gt;<br/>
class AForEachUI&lt; T &gt;</div><p>Used to lazily present possibly large or infinite linear non-hierarchical sequences of data.</p>
<dl class="section warning"><dt>Warning</dt><dd>This API is experimental. Experimental APIs are likely to contain bugs, might be changed or removed in the future. </dd></dl>
<dl class="section user"><dt></dt><dd></dd></dl>
<dl class="section note"><dt>Note</dt><dd>If you are familiar with RecyclerView/LazyColumn/LazyRow/LazyVStack/LazyHStack, <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> follows the same set of principles; with an exception: <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> does not provide a scrollable area on its own.</dd></dl>
<p><a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> is created by using <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> macro.</p>
<p><a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> mimics <em>ranged for loop</em> semantically.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> std::array users = { <span class="stringliteral">"Foo"</span>, <span class="stringliteral">"Bar"</span>, <span class="stringliteral">"Lol"</span> };</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; user : users) {</div>
<div class="line">  fmt::println(<span class="stringliteral">"{}"</span>, user);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> std::array users = { <span class="stringliteral">"Foo"</span>, <span class="stringliteral">"Bar"</span>, <span class="stringliteral">"Lol"</span> };</div>
<div class="line">...</div>
<div class="line">setContents(Centered {</div>
<div class="line">  <a class="code hl_class" href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a>().withContents(</div>
<div class="line">    <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(user, users, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">      <span class="keywordflow">return</span> Label { fmt::format(<span class="stringliteral">"{}"</span>, user) };</div>
<div class="line">    }</div>
<div class="line">  ).build() <a class="code hl_define" href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a> { FixedSize { 150_dp, 200_dp } },</div>
<div class="line">});</div>
<div class="ttc" id="aclassAScrollArea_1_1Builder_html"><div class="ttname"><a href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a></div><div class="ttdef"><b>Definition</b> AScrollArea.h:130</div></div>
<div class="ttc" id="aclassAVerticalLayout_html"><div class="ttname"><a href="classAVerticalLayout.html">AVerticalLayout</a></div><div class="ttdoc">Places views in a column.</div><div class="ttdef"><b>Definition</b> AVerticalLayout.h:41</div></div>
<div class="ttc" id="agroup__useful__macros_html_ga3b247bd8a48a4e7cae4882e19ef45cbc"><div class="ttname"><a href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a></div><div class="ttdeci">#define AUI_DECLARATIVE_FOR(value, model, layout)</div><div class="ttdoc">ranged-for-loop style wrapped for AForEachUI.</div><div class="ttdef"><b>Definition</b> AForEachUI.h:402</div></div>
<div class="ttc" id="agroup__useful__macros_html_ga626d77a14ebf21eb52de159eb9e75c1c"><div class="ttname"><a href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a></div><div class="ttdeci">#define with_style</div><div class="ttdoc">Allows to define a style to the view right in place.</div><div class="ttdef"><b>Definition</b> kAUI.h:287</div></div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Example_.png"/>
</div>
<p><a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> consists of single entry variable name, a potentially <a class="el" href="namespaceaui_1_1react.html">reactive</a> expression evaluating to <em>range</em>, layout name (acceptable are <code><a class="el" href="classAVerticalLayout.html" title="Places views in a column.">AVerticalLayout</a></code> and <code><a class="el" href="classAHorizontalLayout.html" title="Places views in a row.">AHorizontalLayout</a></code>) and a lambda that creates a new view based on data entry. In terms of C++ syntax, the lambda is partially defined by <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> macro; the lambda's body (including curly braces) is left up to developer. The final declaration of <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> returns an instance of <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a>.</p>
<p><em>range</em> models one-dimensional list.</p>
<p><a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> works on iterator level by design. In fact, any kind of <em>range</em> (C++20 ranges/range-v3) can be used, starting from bidirectional containers such as <code>std::vector</code> and <code>std::list</code>, lazy non-owning dummies like <code>ranges::views::ints</code> and even fancy <em>range</em> views from <code>std::ranges::views</code> or <code>ranges::views</code> are acceptable. One-directional containers like <code>std::queue</code> or <code>std::stack</code> can't be used because they don't implement <code>begin()</code> and <code>end()</code>. As such, requirements to a <em>range</em> are dictated by <code>ranges::range</code> concept.</p>
<ul>
<li><em>range</em> has <code>.begin()</code> method or <code>ranges::begin()</code> overload defined <code>auto it = ranges::begin(rng)</code></li>
<li><em>range</em> has <code>.end()</code> method or <code>ranges::end()</code> overload defined <code>auto it = ranges::end(rng)</code></li>
<li>both <code>begin()</code> and <code>end()</code> return an <em>iterator</em></li>
<li><em>iterator</em> has dereference operator <code>auto&amp; value = *it</code></li>
<li><em>iterator</em> has increment operator <code>++it</code></li>
</ul>
<p>Alternatively, these requirements can be described by a <em>ranged for loop</em>: <code>for (const auto&amp; value : rng) { ... }</code>.</p>
<p>The range's type is erased with runtime-based <em>range</em> layer <a class="el" href="structaui_1_1any__view.html">aui::any_view</a>.</p>
<p><a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> can be nested with no restrictions in both directions.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Examples</h1>
<p>See examples of <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Lazy Semantics</h1>
<p><a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> presents all data available. If placed somewhere inside <a class="el" href="classAScrollArea.html">AScrollArea</a> (implies <a class="el" href="classAScrollAreaViewport.html">AScrollAreaViewport</a>), lazy semantics take place. This means that <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> knows scroll position and sliding window size in pixels, making it possible to present a limited set of data that is actually visible, and present data further as soon as the user scrolls down the scroll area.</p>
<p>Under the hood, <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> stores a pair of iterators of the passed <em>range</em> of presented entries, forming a sliding window subrange. When the user scrolls down the list, both iterators are incremented; when the user scrolls upwards, both iterators are decremented.</p>
<p>In this scenario, <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> adds an extra requirement to range's iterator:</p>
<ul>
<li><em>iterator</em> has decrement operator <code>--it</code></li>
</ul>
<p>If this requirement is not satisfied (case of some <code>ranges::views</code>), <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> would not unload old items, unless a <a class="el" href="#AFOREACHUI_UPDATE">data update event</a> occurred.</p>
<p>The amount of displayed data is governed by <em>range</em> size, <a class="el" href="md_docs_2Render_01to_01texture.html">Render to texture</a> tile size, <a class="el" href="classAScrollArea.html" title="A scrollable container with vertical and horizontal scrollbars.">AScrollArea</a>'s viewport size and individual entry size. Optimal frequency of sliding during scroll and window size are determined by <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a>. In particular, the sliding is performed once per <a class="el" href="md_docs_2Render_01to_01texture.html">Render to texture</a> tile is passed.</p>
<dl class="section note"><dt>Note</dt><dd>During rendering inside <a class="el" href="classAScrollArea.html" title="A scrollable container with vertical and horizontal scrollbars.">AScrollArea</a>, the renderer clips visible views more precisely; the goal of lazy semantics of <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> is to optimize view instantiation and layout processing overhead, as well as <em>range</em> views' lazy semantics, thanks to iterators.</dd></dl>
<h2><a class="anchor" id="autotoc_md42"></a>
Scrollbars</h2>
<p>From perspective of layout, lazy semantics is implemented by careful layout updates driven by scroll area events. If possible, the items that appear far from sliding window are unloaded (views are removed). The new items are loaded (new views are instantiated). To avoid content jittering, scroll position is synced with layout updates within <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a>. As such, these hijacking operations may confuse scroll bar.</p>
<p>In modern software, especially when it comes to infinite lists in web/mobile applications (i.e., news feed), scrollbar might be completely hidden or significantly transparentized.</p>
<p>This optimization gives a severe performance benefit. Despite the fact that there's a complete mess "under the hood" (scrollbar is the only visual confirmation), the scrolled contents appear normal and natural.</p>
<div class="image">
<img alt="" src="edrfgsrgsrg.webp"/>
<div class="caption">
A lie is going on behind the scenes</div></div>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L110"></b></p>
<p>A static range like in the example above will not blow up the machine because <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> is wrapped with a <a class="el" href="classAScrollArea.html">AScrollArea</a>, thus it is not required to evaluate the whole range, which is infinite in our case.</p>
<p>An attempt to update <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> with a large range still can lead to high resource consumption, due to need of recomposition.</p>
<h1><a class="anchor" id="AFOREACHUI_UPDATE"></a>
Initialization</h1>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L145"></b></p>
<p>This section explains how to initialize <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>, manage lifetime of containers and how to make them reactive.</p>
<p>In <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>, a potentially <a class="el" href="namespaceaui_1_1react.html">reactive</a> expression evaluating to <em>range</em> and the lambda that creates a new views are both lambdas with capture default by value <code>[=]</code>. This means that:</p>
<ol type="1">
<li>All mentioned <em>local</em> variables are captured by copying.</li>
<li>All mentioned class member variables (fields) are captured by reference.</li>
</ol>
<p>Both lambdas can be evaluated at any point during lifetime of a <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a>, so the by-value capture makes it's hard to introduce dangling references, by either copying locals or referencing class members.</p>
<p>Most modern compilers are capable to optimize out copying and initialize *copied* locals just in place.</p>
<p>An attempt to go out of the scenarios listed below will likely lead to a <code>static_assert</code> with a link to this section.</p>
<h2><a class="anchor" id="UIDeclarativeForTest_Constant_global_data"></a>
Constant global data</h2>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L163"></b> The most straightforward way is using constant global data: <b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L165"></b> <b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L166"></b> <b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L167"></b> <b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L168"></b> </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> COLORS = { <span class="stringliteral">"Red"</span>, <span class="stringliteral">"Green"</span>, <span class="stringliteral">"Blue"</span>, <span class="stringliteral">"Black"</span>, <span class="stringliteral">"White"</span> };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyWindow: <span class="keyword">public</span> <a class="code hl_class" href="classAWindow.html">AWindow</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MyWindow() {</div>
<div class="line">        <a class="code hl_function" href="classAViewContainer.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">            <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, COLORS, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">              <span class="keywordflow">return</span> Label { <span class="stringliteral">"{}"</span>_format(i) };</div>
<div class="line">            }</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><a class="code hl_define" href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a> {</div>
<div class="line">  <span class="keyword">auto</span> w = _new&lt;MyWindow&gt;();</div>
<div class="line">  w-&gt;show();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassAViewContainer_html_ab7bcd4a4bc08fc11c9bc1a9ff036f5e4"><div class="ttname"><a href="classAViewContainer.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">AViewContainer::setContents</a></div><div class="ttdeci">void setContents(const _&lt; AViewContainer &gt; &amp;container)</div><div class="ttdoc">Moves (like via std::move) all children and layout of the specified container to this container.</div></div>
<div class="ttc" id="aclassAWindow_html"><div class="ttname"><a href="classAWindow.html">AWindow</a></div><div class="ttdoc">Represents a window in the underlying windowing system.</div><div class="ttdef"><b>Definition</b> AWindow.h:45</div></div>
<div class="ttc" id="agroup__useful__macros_html_ga9fb2be9313369673815a6892aa7f3a1f"><div class="ttname"><a href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a></div><div class="ttdeci">#define AUI_ENTRY</div><div class="ttdoc">Application entry point.</div><div class="ttdef"><b>Definition</b> Entry.h:90</div></div>
</div><!-- fragment --><p>It's a good idea to wrap <a class="el" href="classAForEachUI.html" title="Customizable lists display.">AForEachUI</a> with an <a class="el" href="classAScrollArea.html">AScrollArea</a>. </p><div class="fragment"><div class="line"><a class="code hl_function" href="classAViewContainerBase.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">    <a class="code hl_class" href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a>()</div>
<div class="line">        .withContents(</div>
<div class="line">            <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, COLORS, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">              <span class="keywordflow">return</span> Label { <span class="stringliteral">"{}"</span>_format(i) };</div>
<div class="line">            })</div>
<div class="line">        .build() <a class="code hl_define" href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a> { FixedSize { 150_dp, 200_dp } },</div>
<div class="line">});</div>
<div class="ttc" id="aclassAViewContainerBase_html_ab7bcd4a4bc08fc11c9bc1a9ff036f5e4"><div class="ttname"><a href="classAViewContainerBase.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">AViewContainerBase::setContents</a></div><div class="ttdeci">void setContents(const _&lt; AViewContainer &gt; &amp;container)</div><div class="ttdoc">Moves (like via std::move) all children and layout of the specified container to this container.</div></div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Constant_global_data2_.png"/>
</div>
<h2><a class="anchor" id="UIDeclarativeForTest_Infinite_ranges_and_views"></a>
Infinite ranges and views</h2>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L220"></b> Most generators, ranges and views are expected to work. </p><div class="fragment"><div class="line"><a class="code hl_function" href="classAViewContainerBase.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">    <a class="code hl_class" href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a>().withContents(</div>
<div class="line">        <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, ranges::views::ints, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">            <span class="keywordflow">return</span> Label { <span class="stringliteral">"{}"</span>_format(i) };</div>
<div class="line">        }</div>
<div class="line">    ).build() <a class="code hl_define" href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a> { FixedSize { 150_dp, 200_dp } },</div>
<div class="line">});</div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Infinite_ranges_and_views_.png"/>
</div>
<h2><a class="anchor" id="UIDeclarativeForTest_Transferring_ownership_by_copying"></a>
Transferring ownership by copying</h2>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L240"></b> When using locals, their immediate values are copied during initialization of AUI_DECLARATIVE_FOR. </p><div class="fragment"><div class="line"><span class="keyword">auto</span> items = <a class="code hl_class" href="classAVector.html">AVector&lt;AString&gt;</a> { <span class="stringliteral">"Hello"</span>, <span class="stringliteral">"World"</span>, <span class="stringliteral">"Test"</span> };</div>
<div class="line"><a class="code hl_function" href="classAViewContainerBase.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">    <a class="code hl_class" href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a>().withContents(</div>
<div class="line">        <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, items, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">           <span class="keywordflow">return</span> Label { i };</div>
<div class="line">        }</div>
<div class="line">    ).build() <a class="code hl_define" href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a> { FixedSize { 150_dp, 200_dp } },</div>
<div class="line">});</div>
<div class="ttc" id="aclassAVector_html"><div class="ttname"><a href="classAVector.html">AVector</a></div><div class="ttdoc">A std::vector with AUI extensions.</div><div class="ttdef"><b>Definition</b> AVector.h:39</div></div>
</div><!-- fragment --><p>As such, an attempt to modify <code>items</code> will not reflect on presentation, because it has own copy of <code>items</code>. </p><div class="fragment"><div class="line">items.push_back(<span class="stringliteral">"Bruh"</span>);</div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Transferring_ownership_by_copying_.png"/>
</div>
<h2><a class="anchor" id="UIDeclarativeForTest_Borrowing_constant_containers"></a>
Borrowing constant containers</h2>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L271"></b> If your container lives inside your class, its value is not copied but referenced. To avoid unobserved iterator invalidation and content changes, <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> requires borrowed containers to be constant. There's a compile-time check to verify this requirement that does work in most cases, like this one.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyWindow: <span class="keyword">public</span> <a class="code hl_class" href="classAWindow.html">AWindow</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MyWindow(<a class="code hl_class" href="classAVector.html">AVector&lt;AString&gt;</a> colors): mColors(std::move(colors)) {</div>
<div class="line">        <a class="code hl_function" href="classAViewContainer.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">            <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, mColors, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">              <span class="keywordflow">return</span> Label { <span class="stringliteral">"{}"</span>_format(i) };</div>
<div class="line">            }</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> AVector&lt;AString&gt; mColors;</div>
<div class="line">};</div>
<div class="line"><a class="code hl_define" href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a> {</div>
<div class="line">     <span class="keyword">auto</span> w = _new&lt;MyWindow&gt;(AVector&lt;AString&gt;{ <span class="stringliteral">"Red"</span>, <span class="stringliteral">"Green"</span>, <span class="stringliteral">"Blue"</span>, <span class="stringliteral">"Black"</span>, <span class="stringliteral">"White"</span> });</div>
<div class="line">     w-&gt;show();</div>
<div class="line">     <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Borrowing_constant_containers_.png"/>
</div>
<p>Marking the borrowed container as const effectively saves you from unintended borrowed data changes. If you'd like to change the container or view options and <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> to respond to the changes, read the section below.</p>
<h2><a class="anchor" id="UIDeclarativeForTest_Reactive_lists"></a>
Reactive lists</h2>
<p><b aui-src="aui.uitests/tests/UIDeclarativeForTest.cpp#L309"></b> The reason why <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> is so restrictive about using borrowed non-const data is because it stores <em>range</em>'s iterators under the hood. Various containers have different rules on iterator invalidation, but, since it accepts any type of <em>range</em>, we consider using its iterators after a modifying access to the container or a view as unsafe:</p><ul>
<li>visual presentation by <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> might seem unresponsive to borrowed data changes,</li>
<li>may lead to program crash.</li>
</ul>
<p>To address this issue, we provide a convenient <a class="el" href="group__property__system.html">way</a> to make iterator invalidation <em>observable</em>:</p>
<ul>
<li>wrap the container with <code><a class="el" href="structAProperty.html" title="Basic easy-to-use property implementation containing T.">AProperty</a></code>,</li>
<li>dereference <code>mColors</code> in <a class="el" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a> clause.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyWindow: <span class="keyword">public</span> <a class="code hl_class" href="classAWindow.html">AWindow</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MyWindow(<a class="code hl_class" href="classAVector.html">AVector&lt;AString&gt;</a> colors): mColors(std::move(colors)) {</div>
<div class="line">        <a class="code hl_function" href="classAViewContainer.html#ab7bcd4a4bc08fc11c9bc1a9ff036f5e4">setContents</a>(Vertical {</div>
<div class="line">            _new&lt;AButton&gt;(<span class="stringliteral">"Add A new color"</span>).connect(&amp;<a class="code hl_variable" href="classAView.html#af2361cde3ebf9e0b410c28dab746029d">AView::clicked</a>, me::addColor),</div>
<div class="line">            <a class="code hl_class" href="classAScrollArea_1_1Builder.html">AScrollArea::Builder</a>().withContents(</div>
<div class="line">              <a class="code hl_define" href="group__useful__macros.html#ga3b247bd8a48a4e7cae4882e19ef45cbc">AUI_DECLARATIVE_FOR</a>(i, *mColors, <a class="code hl_class" href="classAVerticalLayout.html">AVerticalLayout</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> Label { <span class="stringliteral">"{}"</span>_format(i) };</div>
<div class="line">              }</div>
<div class="line">            ).build() <a class="code hl_define" href="group__useful__macros.html#ga626d77a14ebf21eb52de159eb9e75c1c">with_style</a> { FixedSize { 150_dp, 200_dp } },</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    AProperty&lt;AVector&lt;AString&gt;&gt; mColors;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> addColor() {</div>
<div class="line">        mColors.<a class="code hl_function" href="structAProperty.html#ab0229d9ee58c06dacaa012ece0d1d21d">writeScope</a>()-&gt;push_back(<span class="stringliteral">"A new color"</span>);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><a class="code hl_define" href="group__useful__macros.html#ga9fb2be9313369673815a6892aa7f3a1f">AUI_ENTRY</a> {</div>
<div class="line">    <span class="keyword">auto</span> w = _new&lt;MyWindow&gt;(AVector&lt;AString&gt;{ <span class="stringliteral">"Red"</span>, <span class="stringliteral">"Green"</span>, <span class="stringliteral">"Blue"</span>, <span class="stringliteral">"Black"</span>, <span class="stringliteral">"White"</span> });</div>
<div class="line">    w-&gt;show();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassAView_html_af2361cde3ebf9e0b410c28dab746029d"><div class="ttname"><a href="classAView.html#af2361cde3ebf9e0b410c28dab746029d">AView::clicked</a></div><div class="ttdeci">emits clicked</div><div class="ttdoc">Left mouse button clicked.</div><div class="ttdef"><b>Definition</b> AView.h:945</div></div>
<div class="ttc" id="astructAProperty_html_ab0229d9ee58c06dacaa012ece0d1d21d"><div class="ttname"><a href="structAProperty.html#ab0229d9ee58c06dacaa012ece0d1d21d">AProperty::writeScope</a></div><div class="ttdeci">aui::PropertyModifier&lt; AProperty &gt; writeScope() noexcept</div><div class="ttdef"><b>Definition</b> AProperty.h:141</div></div>
</div><!-- fragment --><div class="image">
<img alt="" src="UIDeclarativeForTest.Reactive_lists_1.png"/>
</div>
<p> Upon clicking "Add A new color" button, the "A new color" label will appear in the list.</p>
<div class="image">
<img alt="" src="UIDeclarativeForTest.Reactive_lists_2.png"/>
</div>
</div><h2 class="groupheader">Member Function Documentation</h2>
<p><a href="classAForEachUI-members.html">&gt; All members, including inherited</a></p>
<a id="a64c6029c521035c07124b843ece7d165" name="a64c6029c521035c07124b843ece7d165"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64c6029c521035c07124b843ece7d165">◆ </a></span>getViewsCache()</h2>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
<tr>
<td class="mlabels-left">
<table class="memname">
<tr>
<td class="memname"><a class="el" href="classAMap.html">aui::for_each_ui::detail::ViewsSharedCache</a> * <a class="el" href="classAForEachUI.html">AForEachUI</a>&lt; T &gt;::getViewsCache </td>
<td>(</td>
<td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
<td></td>
</tr>
</table>
</td>
<td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel override">override</span><span class="mlabel protected">protected</span><span class="mlabel virtual">virtual</span></span> </td>
</tr>
</table>
</div><div class="memdoc">
<p>Called by <code>setModelImpl</code>. The implementation might then use the shared cache to return views from <code>List</code> range.</p>
<p>The implementation is responsible to clean up the cache. </p>
<p>Implements <a class="el" href="classAForEachUIBase.html#a3fea0e0c4186b859f298adab33120e9c">AForEachUIBase</a>.</p>
</div>
</div>
<a id="ac46fd871a23cabf5db3dc28dd0166b27" name="ac46fd871a23cabf5db3dc28dd0166b27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac46fd871a23cabf5db3dc28dd0166b27">◆ </a></span>invalidate()</h2>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
<tr>
<td class="mlabels-left">
<table class="memname">
<tr>
<td class="memname">void <a class="el" href="classAForEachUI.html">AForEachUI</a>&lt; T &gt;::invalidate </td>
<td>(</td>
<td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
<td></td>
</tr>
</table>
</td>
<td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel override">override</span><span class="mlabel virtual">virtual</span></span> </td>
</tr>
</table>
</div><div class="memdoc">
<p>Implements <a class="el" href="structaui_1_1react_1_1DependencyObserver.html">aui::react::DependencyObserver</a>.</p>
</div>
</div>
<p class="footer-inner">
    © 2025 AUI Framework Contributors. Documentation contributions included herein are the copyrights of their
    respective owners. The documentation provided herein is licensed under the terms of the GNU Free Documentation
    License version 1.3 as published by the Free Software Foundation. All trademarks are property of their respective owners.
</p>
</div><div class="contents-rails-right"><div class="aui-toc"><p>Contents</p><div class="aui-toc-extras"><a href="javascript:jumpToSource('view')"><i class="fa fa-file"></i>View Page Source</a><a href="javascript:jumpToSource('edit')"><i class="fa fa-edit"></i>Edit Page Source</a></div></div></div></div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: 'dark',
        themeVariables: {
            primaryTextColor: '#d2dbde',
            lineColor: '#1982d2',
            tertiaryColor: '#272c34',
        },
    });
</script>
</div></body>
</html>
